DROP TABLE AUTORI CASCADE CONSTRAINTS;
DROP TABLE CARTI CASCADE CONSTRAINTS;
DROP TABLE IMPRUMUTURI CASCADE CONSTRAINTS;
DROP TABLE STUDENTI CASCADE CONSTRAINTS;

CREATE TABLE STUDENTI
(
ID_STUDENT NUMBER(2) PRIMARY KEY, 
NUME VARCHAR2(25),
PRENUME VARCHAR2(30),
DATA_NASTERE DATE,
GEN VARCHAR2(1),
CLASA NUMBER(4)
);
ALTER TABLE STUDENTI MODIFY NUME NOT NULL;
ALTER TABLE STUDENTI MODIFY PRENUME NOT NULL;
ALTER TABLE STUDENTI MODIFY DATA_NASTERE NOT NULL;
ALTER TABLE STUDENTI MODIFY CLASA NOT NULL;
ALTER TABLE STUDENTI ADD CONSTRAINT CHK_GEN CHECK (GEN IN ('F','M'));

CREATE TABLE IMPRUMUTURI 
(
ID_IMPRUMUT NUMBER(2)PRIMARY KEY, 
ID_STUDENT NUMBER(2),
ID_CARTE NUMBER(2),
DATA_IMPRUMUT DATE,
DATA_RETUR DATE
);
ALTER TABLE IMPRUMUTURI ADD CONSTRAINT FK_STUD FOREIGN KEY(ID_STUDENT) REFERENCES STUDENTI(ID_STUDENT);
ALTER TABLE IMPRUMUTURI ADD CONSTRAINT FK_CARTE FOREIGN KEY(ID_CARTE) REFERENCES CARTI(ID_CARTE);
ALTER TABLE IMPRUMUTURI MODIFY DATA_IMPRUMUT NOT NULL;
ALTER TABLE IMPRUMUTURI MODIFY DATA_RETUR NOT NULL;

CREATE TABLE CARTI
(
ID_CARTE NUMBER(2)PRIMARY KEY,
ID_AUTOR NUMBER(2),
NUME_CARTE VARCHAR2(50),
NR_PAGINI NUMBER,
ID_TIP NUMBER(2)
);
ALTER TABLE CARTI ADD CONSTRAINT FK_AUTOR FOREIGN KEY(ID_AUTOR) REFERENCES AUTORI(ID_AUTOR);
ALTER TABLE CARTI ADD CONSTRAINT FK_TIP FOREIGN KEY(ID_TIP) REFERENCES TIPURI(ID_TIP);
ALTER TABLE CARTI MODIFY NUME_CARTE NOT NULL;
ALTER TABLE CARTI MODIFY NR_PAGINI NOT NULL;

CREATE TABLE AUTORI
(
ID_AUTOR NUMBER(2) PRIMARY KEY,
NUME_AUTOR VARCHAR2(25),
PRENUME_AUTOR VARCHAR2(30)
);
ALTER TABLE AUTORI MODIFY NUME_AUTOR NOT NULL;
ALTER TABLE AUTORI MODIFY PRENUME_AUTOR NOT NULL;

CREATE TABLE TIPURI
(
ID_TIP NUMBER(2) PRIMARY KEY,
TIP_CARTE VARCHAR2(25)
);
ALTER TABLE TIPURI MODIFY TIP_CARTE NOT NULL;


-- INSERTURI
INSERT INTO STUDENTI VALUES(01,'Chita','Mihai',to_date('24-03-1999','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(02,'Popa','Andreea',to_date('04-03-1998','dd-mm-yyyy'),'F',1014);
INSERT INTO STUDENTI VALUES(03,'Sima','Ioana',to_date('18-03-1998','dd-mm-yyyy'),'F',1013);
INSERT INTO STUDENTI VALUES(04,'Zanfir','Maria',to_date('25-02-1998','dd-mm-yyyy'),'F',1011);
INSERT INTO STUDENTI VALUES(05,'Georgesu','Adi',to_date('21-02-1999','dd-mm-yyyy'),'M',1013);
INSERT INTO STUDENTI VALUES(06,'Ionescu','Calin',to_date('17-06-1999','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(07,'Dumitrescu','Andrei',to_date('14-07-1996','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(08,'Grigore','Mihai',to_date('03-08-1997','dd-mm-yyyy'),'M',1013);
INSERT INTO STUDENTI VALUES(09,'Dragnea','Ionut',to_date('16-08-1999','dd-mm-yyyy'),'M',1013);
INSERT INTO STUDENTI VALUES(10,'Stefanescu','Denisa',to_date('04-06-1999','dd-mm-yyyy'),'F',1012);
INSERT INTO STUDENTI VALUES(11,'Irimescu','Maria',to_date('05-03-1998','dd-mm-yyyy'),'F',1013);
INSERT INTO STUDENTI VALUES(12,'Andreescu','Ana',to_date('26-10-1999','dd-mm-yyyy'),'F',1011);
INSERT INTO STUDENTI VALUES(13,'Chiran','Sebastian',to_date('28-11-1999','dd-mm-yyyy'),'M',1011);
INSERT INTO STUDENTI VALUES(14,'Dragulescu','Catalin',to_date('16-06-1999','dd-mm-yyyy'),'M',1013);
INSERT INTO STUDENTI VALUES(15,'Ivanescu','Cristina',to_date('18-07-1999','dd-mm-yyyy'),'F',1014);
INSERT INTO STUDENTI VALUES(16,'Barbieru','Elena',to_date('18-07-1999','dd-mm-yyyy'),'F',1014);
INSERT INTO STUDENTI VALUES(17,'Popescu','Cristi',to_date('12-06-1998','dd-mm-yyyy'),'M',1012);
INSERT INTO STUDENTI VALUES(18,'Marinescu','Cezar',to_date('17-04-1999','dd-mm-yyyy'),'M',1011);
INSERT INTO STUDENTI VALUES(19,'Avram','Adrian',to_date('30-09-1997','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(20,'Radu','Bogdan',to_date('08-03-1997','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(21,'Cioiu','Maria',to_date('12-03-1999','dd-mm-yyyy'),'F',1011);
INSERT INTO STUDENTI VALUES(22,'Popescu','Alex',to_date('25-12-1999','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(23,'Dudea','Andreea',to_date('21-10-1998','dd-mm-yyyy'),'F',1012);
INSERT INTO STUDENTI VALUES(24,'Popa','Mihai',to_date('22-10-1996','dd-mm-yyyy'),'M',1014);
INSERT INTO STUDENTI VALUES(25,'Petrescu','Adrian',to_date('26-06-1996','dd-mm-yyyy'),'M',1012);
INSERT INTO STUDENTI VALUES(26,'Patrascu','Diana',to_date('17-10-1997','dd-mm-yyyy'),'F',1012);
INSERT INTO STUDENTI VALUES(27,'Balan','Iuliana',to_date('24-11-1996','dd-mm-yyyy'),'F',1011);
INSERT INTO STUDENTI VALUES(28,'Draghici','Elisa',to_date('16-12-1996','dd-mm-yyyy'),'F',1013);
INSERT INTO STUDENTI VALUES(29,'Stancu','Monica',to_date('19-08-1997','dd-mm-yyyy'),'F',1012);
INSERT INTO STUDENTI VALUES(30,'Stefan','Ioana',to_date('20-05-1996','dd-mm-yyyy'),'F',1011);
INSERT INTO STUDENTI VALUES(31,'Branescu','Alexandra',to_date('23-06-1996','dd-mm-yyyy'),'F',1011);
INSERT INTO STUDENTI VALUES(32,'Alexandrescu','Cristian',to_date('23-04-1998','dd-mm-yyyy'),'M',1012);
INSERT INTO STUDENTI VALUES(33,'Zabava','Catalin',to_date('22-04-1997','dd-mm-yyyy'),'M',1013);
INSERT INTO STUDENTI VALUES(34,'Radu','Alexandra',to_date('14-09-1999','dd-mm-yyyy'),'F',1013);
INSERT INTO STUDENTI VALUES(35,'Damascu','Radu',to_date('17-12-1999','dd-mm-yyyy'),'M',1012);
INSERT INTO STUDENTI VALUES(36,'Zamfir','Cristiana',to_date('19-08-1998','dd-mm-yyyy'),'F',1011);
commit;

INSERT INTO AUTORI VALUES(01,'F.Scott','Fitzgerald');
INSERT INTO AUTORI VALUES(02,'Dickens','Charles');
INSERT INTO AUTORI VALUES(03,'Austen','Jane');
INSERT INTO AUTORI VALUES(04,'Woolf','Virginia');
INSERT INTO AUTORI VALUES(05,'Orwell','George');
INSERT INTO AUTORI VALUES(06,'Kafka','Franz');
INSERT INTO AUTORI VALUES(07,'Dahl','Roald');
INSERT INTO AUTORI VALUES(08,'Hugo','Victor');
INSERT INTO AUTORI VALUES(09,'Carroll','Lewis');
INSERT INTO AUTORI VALUES(10,'Bronte','Emily');
commit;

INSERT INTO TIPURI VALUES(01,'FICTIUNE');
INSERT INTO TIPURI VALUES(02,'NON-FICTIUNE');
INSERT INTO TIPURI VALUES(03,'SF');
INSERT INTO TIPURI VALUES(04,'FICTIUNE ISTORICA');
INSERT INTO TIPURI VALUES(05,'POEZIE');
INSERT INTO TIPURI VALUES(06,'THRILLER');
INSERT INTO TIPURI VALUES(07,'FABULA');
INSERT INTO TIPURI VALUES(08,'COMEDIE');
INSERT INTO TIPURI VALUES(09,'DRAMA');
INSERT INTO TIPURI VALUES(10,'FILOZOFIE');
commit;


INSERT INTO CARTI VALUES (01,02,'Great Expectations',505,01);
INSERT INTO CARTI VALUES (02,04,'Mrs Dalloway',194,01);
INSERT INTO CARTI VALUES (03,10,'Wuthering Heights',464,04);
INSERT INTO CARTI VALUES (04,06,'The Metamorphosis',201,03);
INSERT INTO CARTI VALUES (05,09,'Through the Looking-Glass',208,03);
INSERT INTO CARTI VALUES (06,08,'Les Misérables',1463,04);
INSERT INTO CARTI VALUES (07,07,'Matilda',240,03);
INSERT INTO CARTI VALUES (08,04,'To the Lighthouse',204,01);
INSERT INTO CARTI VALUES (09,10,'Poems by Currer, Ellis and Acton Bell',218,05);
INSERT INTO CARTI VALUES (10,07,'James and the Giant Peach',146,03);
INSERT INTO CARTI VALUES (11,02,'Oliver Twist',608,01);
INSERT INTO CARTI VALUES (12,04,'The Waves',297,01);
INSERT INTO CARTI VALUES (13,03,'Pride and Prejudice',279,09);
INSERT INTO CARTI VALUES (14,01,'The Great Gatsby',200,04);
INSERT INTO CARTI VALUES (15,05,'1984',237,03);
commit;

INSERT INTO IMPRUMUTURI VALUES (01,15,03,TO_DATE('01-05-2020','dd-mm-yyyy'),TO_DATE('01-07-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (02,02,04,TO_DATE('01-04-2020','dd-mm-yyyy'),TO_DATE('01-06-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (03,14,05,TO_DATE('01-07-2020','dd-mm-yyyy'),TO_DATE('01-09-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (04,31,07,TO_DATE('01-06-2020','dd-mm-yyyy'),TO_DATE('01-08-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (05,27,02,TO_DATE('01-07-2020','dd-mm-yyyy'),TO_DATE('01-09-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (06,09,03,TO_DATE('01-02-2020','dd-mm-yyyy'),TO_DATE('01-04-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (07,17,12,TO_DATE('01-05-2020','dd-mm-yyyy'),TO_DATE('01-07-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (08,18,14,TO_DATE('01-03-2020','dd-mm-yyyy'),TO_DATE('01-05-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (09,10,09,TO_DATE('01-01-2020','dd-mm-yyyy'),TO_DATE('01-03-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (10,29,08,TO_DATE('01-07-2020','dd-mm-yyyy'),TO_DATE('01-09-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (11,02,01,TO_DATE('01-04-2020','dd-mm-yyyy'),TO_DATE('01-06-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (12,16,06,TO_DATE('01-05-2020','dd-mm-yyyy'),TO_DATE('01-07-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (13,18,11,TO_DATE('01-04-2020','dd-mm-yyyy'),TO_DATE('01-06-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (14,18,15,TO_DATE('01-02-2020','dd-mm-yyyy'),TO_DATE('01-04-2020','dd-mm-yyyy'));
INSERT INTO IMPRUMUTURI VALUES (15,21,01,TO_DATE('01-08-2020','dd-mm-yyyy'),TO_DATE('01-10-2020','dd-mm-yyyy'));
commit;

SELECT * FROM STUDENTI order by id_student DESC;
SELECT * FROM CARTI;
SELECT * FROM IMPRUMUTURI;
SELECT * FROM TIPURI;
SELECT * FROM AUTORI;


select * from user_tables;

select * from user_tab_cols where table_name = 'AUTORI';
select * from user_tab_cols where table_name = 'TIPURI';

SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE,TABLE_NAME FROM USER_CONSTRAINTS WHERE TABLE_NAME LIKE 'STUDENTI' ;
SELECT CONSTRAINT_NAME, CONSTRAINT_TYPE,TABLE_NAME FROM USER_CONSTRAINTS WHERE TABLE_NAME LIKE 'IMPRUMUTURI' ;
-- 1.	Afisarea studentilor care au returnat cărtile împrumutate mai devreme de luna August. 
SELECT  NUME,PRENUME,CLASA
FROM STUDENTI
WHERE ID_STUDENT IN 
     (SELECT ID_STUDENT FROM IMPRUMUTURI WHERE EXTRACT(MONTH FROM DATA_RETUR)<8) ORDER BY NUME;
-- 2.	Afisarea studentilor care au împrumutat cărti intre luna aprilie si iunie.
SELECT  ID_STUDENT,NUME,PRENUME,CLASA
FROM STUDENTI
WHERE ID_STUDENT IN 
     (SELECT ID_STUDENT FROM IMPRUMUTURI WHERE EXTRACT(MONTH FROM DATA_IMPRUMUT) BETWEEN 4 AND 6) ORDER BY NUME;
-- 3.	Afisarea tuturor studentilor care au împrumutat cărti.
SELECT S.ID_STUDENT,S.NUME,S.PRENUME
FROM STUDENTI S
WHERE S.ID_STUDENT
IN (SELECT I.ID_STUDENT FROM IMPRUMUTURI I WHERE I.ID_STUDENT = S.ID_STUDENT) ORDER BY ID_STUDENT ASC;
-- 4.	Afisarea studentilor care nu au împrumutat cărti. 
SELECT S.ID_STUDENT,S.NUME,S.PRENUME
FROM STUDENTI S
WHERE S.ID_STUDENT
NOT IN (SELECT I.ID_STUDENT FROM IMPRUMUTURI I WHERE I.ID_STUDENT = S.ID_STUDENT) ORDER BY ID_STUDENT ASC;
--5.	Afisarea autorilor, cărtilor pe care le-au scris, cat si tipul acestora.
SELECT A.NUME_AUTOR,A.PRENUME_AUTOR, C.NUME_CARTE, T.TIP_CARTE
FROM AUTORI A, CARTI C, TIPURI T
WHERE A.ID_AUTOR=C.ID_AUTOR AND C.ID_TIP=T.ID_TIP 
ORDER BY 1;
--6.	Afisarea studentilor, numele cărtilor, data împrumutului pentru cărtile de tipul fictiune istorica. 
SELECT S.NUME, S.PRENUME, C.NUME_CARTE, T.TIP_CARTE,I.DATA_IMPRUMUT
FROM
STUDENTI S,IMPRUMUTURI I,TIPURI T, CARTI C
WHERE 
S.ID_STUDENT = I.ID_STUDENT AND I.ID_CARTE=C.ID_CARTE AND C.ID_TIP=T.ID_TIP
AND TIP_CARTE=UPPER('FICTIUNE ISTORICA') AND EXTRACT(MONTH FROM DATA_IMPRUMUT)>=3
ORDER BY S.ID_STUDENT;
--7.	Afisarea numărului mediu de pagini a operelor in functie de autor. 
SELECT A.NUME_AUTOR, AVG(C.NR_PAGINI) AS MEDIE_NR_PAG FROM AUTORI A, CARTI C
WHERE A.ID_AUTOR=C.ID_AUTOR
GROUP BY A.NUME_AUTOR;

/*altele decat tabele: vederi, secvente,
sinonime, indecsi; creare, modificare/stergere, dupa caz a obiectelor; confirmarea
existentei/inexistentei obiectelor in dictionarul datelor*/ -- to do
-- VIEWS 

CREATE OR REPLACE VIEW AUTORI_CARTI(ID_AUTOR,NUME_CARTE,NR_PAGINI,ID_TIP)
AS 
SELECT A.ID_AUTOR,C.NUME_CARTE,C.NR_PAGINI,C.ID_TIP
FROM AUTORI A
INNER JOIN CARTI C
ON C.ID_AUTOR = A.ID_AUTOR
WHERE C.NR_PAGINI > 250;

SELECT * FROM AUTORI_CARTI;
SELECT * FROM USER_VIEWS;

--  SINONIME
CREATE OR REPLACE SYNONYM S_STUDENTI FOR STUDENTI ;

SELECT * FROM S_STUDENTI;
SELECT * FROM USER_SYNONYMS;
DROP SYNONYM S_STUDENTI;

SELECT COUNT(*) FROM USER_SYNONYMS;
-- SECVENTE

select * from studenti order by id_student desc;

CREATE  SEQUENCE SEQUENCE2
START WITH 36
INCREMENT BY 1
MINVALUE 0
MAXVALUE 100
CYCLE;

INSERT INTO STUDENTI VALUES(SEQUENCE2.NEXTVAL,'Chirita','Ana',to_date('25-06-1998','dd-mm-yyyy'),'F',1011);

UPDATE STUDENTI
SET CLASA = 1012
WHERE ID_STUDENT = 37;

UPDATE IMPRUMUTURI
SET DATA_IMPRUMUT = '01-10-2020'
WHERE ID_IMPRUMUT = 15;

DELETE FROM STUDENTI WHERE ID_STUDENT = 37;
COMMIT;